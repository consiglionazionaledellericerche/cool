<?xml version="1.0" encoding="UTF-8"?>

<model name="cnrfirma:workflowmodel" xmlns="http://www.alfresco.org/model/dictionary/1.0">

  <description>Workflow Model</description>
  <author>Massimo Fraticelli</author>
  <version>1.1</version>
  
   <imports>
      <import uri="http://www.alfresco.org/model/dictionary/1.0" prefix="d"/>
      <import uri="http://www.alfresco.org/model/content/1.0" prefix="cm"/>
      <import uri="http://www.cnr.it/model/workflow/1.0" prefix="wfcnr"/>
   </imports>

   <namespaces>
      <namespace uri="http://www.cnr.it/model/firma/1.0" prefix="cnrfirma"/>
   </namespaces>


    <constraints>
      <constraint name="cnrfirma:multipleReviewOutcomeOptions" type="LIST">
          <parameter name="allowedValues">
              <list>
                  <value>SimpleApprove</value>
                  <value>ComplexApprove</value>
                  <value>AskGroupOpinion</value>
                  <value>AskUserOpinion</value>
                  <value>Reject</value>
              </list>
          </parameter>
      </constraint>
   </constraints>  
   
   <types>
   
     <!--  TYPES -->
      <type name="cnrfirma:submitFlussoFirmaTask">
         <title>Inizio Ciclo Approvazione Documento</title>
         <description>Inizio Ciclo Approvazione Documento</description>
         <parent>wfcnr:submitGroupReviewTask</parent>
         <mandatory-aspects>
            <aspect>cnrfirma:ufficioCompetente</aspect>
            <aspect>cnrfirma:codiceDocumento</aspect>
            <aspect>cnrfirma:codiceProtocollo</aspect>
         </mandatory-aspects>
      </type>
   
      <type name="cnrfirma:approvaFlussoFirmaTask">
         <title>Approvazione Documento</title>
         <description>Approvazione Documento</description>
         <parent>wfcnr:activitiReviewTask</parent>
          <properties>
             <property name="cnrfirma:codiceDocumentoUfficio">
               <title>Codice Documento Ufficio</title>
               <description>Codice Documento Ufficio</description>
               <type>d:text</type>
             </property>
          </properties>
          <overrides>
                <property name="wfcnr:reviewOutcome">
                    <default>Reject</default>
                    <constraints>
                      <constraint ref="cnrfirma:multipleReviewOutcomeOptions" />
                    </constraints>
                </property>
          </overrides>
      </type>
   
      <type name="cnrfirma:documentoApprovatoFirmatoTask">
         <title>Documento Approvato con Firma</title>
         <description>Documento Approvato con Firma</description>        
         <parent>wfcnr:approvedTask</parent>
         <mandatory-aspects>
            <aspect>cnrfirma:nodoFolderToLink</aspect>
            <aspect>cnrfirma:parametriFirma</aspect>
         </mandatory-aspects>
      </type>
  
      <type name="cnrfirma:documentoApprovatoSempliceTask">
         <title>Documento Approvato</title>
         <description>Documento Approvato</description>        
         <parent>wfcnr:approvedTask</parent>
         <mandatory-aspects>
            <aspect>cnrfirma:nodoFolderToLink</aspect>
         </mandatory-aspects>
       </type>

      <type name="cnrfirma:documentoRespintoTask">
         <title>Documento Respinto</title>
         <description>Documento Respinto</description>
         <parent>wfcnr:rejectedTask</parent>
      </type>

      <type name="cnrfirma:fornisciParereTask">
         <title>Inserimento Parere</title>
         <description>Inserimento Parere</description>
         <parent>wfcnr:adhocTask</parent>
      </type>

        <type name="cnrfirma:fornisciParereGruppoTask">
         <title>Inserimento Parere Gruppo</title>
         <description>Inserimento Parere Gruppo</description>
         <parent>wfcnr:adhocTask</parent>
      </type>
   </types>

     <!-- ASPECTS -->

   <aspects>
    <aspect name="cnrfirma:codiceDocumento">
       <properties>
          <property name="cnrfirma:codiceDoc">
             <title>Codice Documento</title>
             <description>Codice Documento</description>
             <type>d:text</type>
          </property>
       </properties>
    </aspect>
    <aspect name="cnrfirma:ufficioCompetente">
       <properties>
          <property name="cnrfirma:ufficioAssegnatario">
             <title>Ufficio Assegnatario</title>
             <description>Ufficio Assegnatario</description>
             <type>d:text</type>
          </property>
       </properties>           
    </aspect>
    <aspect name="cnrfirma:codiceProtocollo">
       <properties>
          <property name="cnrfirma:nrProtocollo">
             <title>Numero Protocollo</title>
             <description>Numero Protocollo</description>
             <type>d:text</type>
          </property>
       </properties>           
    </aspect>
    <aspect name="cnrfirma:statoDocumento">
         <title>Stato Documento</title>
         <properties>
          <property name="cnrfirma:statoDoc">
             <title>Stato Documento</title>
             <description>Stato Documento</description>
             <type>d:text</type>
          </property>
       </properties>
      </aspect>
      <aspect name="cnrfirma:nodoFolderToLink">
         <title>Folder di Destinazione</title>
         <properties>
          <property name="cnrfirma:nodeRefFolderToLink">
             <title>Folder di Destinazione</title>
             <description>Folder di Destinazione</description>
             <type>d:text</type>
          </property>
       </properties>
      </aspect>
      <aspect name="cnrfirma:parametriFirma">
         <title>Parametri per la Firma Digitale</title>
         <properties>
          <property name="cnrfirma:userFirma">
             <title>userId utente Firma</title>
             <description>userId utente Firma</description>
             <type>d:text</type>
          </property>
          <property name="cnrfirma:userPwFirma">
             <title>Password utente Firma</title>
             <description>Password utente Firma</description>
             <type>d:text</type>
          </property>
          <property name="cnrfirma:pinFirma">
             <title>PIN Firma</title>
             <description>PIN Firma</description>
             <type>d:text</type>
          </property>
       </properties>
      </aspect>
      <aspect name="cnrfirma:signable">
         <title>Signable</title>
         <properties>
          <property name="cnrfirma:firmato">
             <title>firmato</title>
             <description>firmato</description>
             <type>d:boolean</type>
          </property>
          <property name="cnrfirma:ufficioFirmatario">
             <title>Ufficio Firmatario</title>
             <description>Ufficio Firmatario</description>
             <type>d:text</type>
          </property>
          <property name="cnrfirma:dataFirma">
             <title>data Firma</title>
             <description>data Firma</description>
             <type>d:date</type>
          </property>
       </properties>
       <associations>
            <association name="cnrfirma:signatureAssoc">
               <source>
                  <role>cnrfirma:signedFrom</role>
                  <mandatory>false</mandatory>
                  <many>false</many>
               </source>
               <target>
                  <class>cm:content</class>
                  <role>cnrfirma:signedReference</role>
                  <mandatory>false</mandatory>
                  <many>false</many>
               </target>
            </association>
         </associations>
      </aspect>
  </aspects>
</model>